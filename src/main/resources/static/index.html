<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω Demo</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
</head>
<body>
    <div id="app">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="navbar">
            <div class="nav-container">
                <h1 class="logo">–ú–∞–≥–∞–∑–∏–Ω Demo</h1>
                <div class="cart-info">
                    <span class="cart-count">–ö–æ—Ä–∑–∏–Ω–∞: {{ cartItemCount }} —Ç–æ–≤–∞—Ä–æ–≤</span>
                    <button class="btn btn-cart" @click="showCart = true">
                        üõí –ö–æ—Ä–∑–∏–Ω–∞
                    </button>
                    <a href="/" class="btn btn-primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                </div>
            </div>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="container">
            <h2>–ù–∞—à–∏ —Ç–æ–≤–∞—Ä—ã</h2>
            <div class="products-grid">
                <div v-for="product in products" :key="product.id" class="product-card">
                    <div class="product-image">
                        <img :src="getProductImage(product.id)" :alt="product.name">
                    </div>
                    <div class="product-info">
                        <h3>{{ product.name }}</h3>
                        <p class="price">{{ product.price }} —Ä—É–±.</p>
                        <div class="product-actions">
                            <button class="btn btn-primary" @click="addToCart(product)">
                                –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
        <div v-if="showCart" class="modal-overlay" @click.self="showCart = false">
            <div class="modal">
                <div class="modal-header">
                    <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
                    <button class="close-btn" @click="showCart = false">√ó</button>
                </div>
                <div class="modal-body">
                    <div v-if="cartItems.length === 0" class="empty-cart">
                        <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                    </div>
                    <div v-else>
                        <div v-for="item in cartItems" :key="item.product.id" class="cart-item">
                            <div class="item-info">
                                <h4>{{ item.product.name }}</h4>
                                <p>{{ item.product.price }} —Ä—É–±. √ó {{ item.quantity }} = {{ item.product.price * item.quantity }} —Ä—É–±.</p>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-sm" @click="decreaseQuantity(item.product)">-</button>
                                <span class="quantity">{{ item.quantity }}</span>
                                <button class="btn btn-sm" @click="increaseQuantity(item.product)">+</button>
                                <button class="btn btn-danger btn-sm" @click="removeFromCart(item.product)">
                                    –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                        <div class="cart-total">
                            <h3>–ò—Ç–æ–≥–æ: {{ cartTotal }} —Ä—É–±.</h3>
                        </div>
                        <div class="checkout-actions">
                            <button class="btn btn-primary" @click="proceedToCheckout">
                                –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                            </button>
                            <button class="btn btn-secondary" @click="showCart = false">
                                –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div v-if="notification.show" :class="['notification', notification.type]">
            {{ notification.message }}
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                products: [],
                cartItems: [],
                showCart: false,
                notification: {
                    show: false,
                    message: '',
                    type: 'success'
                }
            },
            computed: {
                cartItemCount() {
                    return this.cartItems.reduce((total, item) => total + item.quantity, 0);
                },
                cartTotal() {
                    return this.cartItems.reduce((total, item) => 
                        total + (item.product.price * item.quantity), 0);
                }
            },
            mounted() {
                this.fetchProducts();
                this.loadCartFromStorage();
            },
            methods: {
                fetchProducts() {
                    fetch('/api/products')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤');
                            }
                            return response.json();
                        })
                        .then(data => {
                            this.products = data;
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞:', error);
                            this.products = [
                                { id: 1, name: "–¢–æ–≤–∞—Ä 1", price: 100 },
                                { id: 2, name: "–¢–æ–≤–∞—Ä 2", price: 200 },
                                { id: 3, name: "–¢–æ–≤–∞—Ä 3", price: 300 },
                                { id: 4, name: "–¢–æ–≤–∞—Ä 4", price: 400 },
                                { id: 5, name: "–¢–æ–≤–∞—Ä 5", price: 500 },
                                { id: 6, name: "–¢–æ–≤–∞—Ä 6", price: 600 }
                            ];
                            this.showNotification('–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'info');
                        });
                },
                getProductImage(productId) {
                    return `https://via.placeholder.com/200x150?text=–¢–æ–≤–∞—Ä+${productId}`;
                },
                addToCart(product) {
                    const existingItem = this.cartItems.find(item => item.product.id === product.id);
                    
                    if (existingItem) {
                        existingItem.quantity += 1;
                    } else {
                        this.cartItems.push({
                            product: product,
                            quantity: 1
                        });
                    }
                    
                    this.saveCartToStorage();
                    this.showNotification('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É', 'success');
                },
                removeFromCart(product) {
                    this.cartItems = this.cartItems.filter(item => item.product.id !== product.id);
                    this.saveCartToStorage();
                    this.showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã', 'info');
                },
                increaseQuantity(product) {
                    const item = this.cartItems.find(item => item.product.id === product.id);
                    if (item) {
                        item.quantity += 1;
                        this.saveCartToStorage();
                    }
                },
                decreaseQuantity(product) {
                    const item = this.cartItems.find(item => item.product.id === product.id);
                    if (item) {
                        if (item.quantity > 1) {
                            item.quantity -= 1;
                        } else {
                            this.removeFromCart(product);
                        }
                        this.saveCartToStorage();
                    }
                },
                proceedToCheckout() {
                    const checkoutData = this.cartItems.map(item => ({
                        productId: item.product.id,
                        quantity: item.quantity
                    }));
                    
                    fetch('/api/checkout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(checkoutData)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞');
                        }
                        return response.json();
                    })
                    .then(data => {
                        this.showNotification(data.message, 'success');
                        this.cartItems = [];
                        this.saveCartToStorage();
                        this.showCart = false;
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞:', error);
                        this.showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑', 'error');
                    });
                },
                saveCartToStorage() {
                    localStorage.setItem('cartItems', JSON.stringify(this.cartItems));
                },
                loadCartFromStorage() {
                    const savedCart = localStorage.getItem('cartItems');
                    if (savedCart) {
                        this.cartItems = JSON.parse(savedCart);
                    }
                },
                showNotification(message, type = 'success') {
                    this.notification = {
                        show: true,
                        message,
                        type
                    };
                    
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 3000);
                }
            }
        });
    </script>
</body>
</html>